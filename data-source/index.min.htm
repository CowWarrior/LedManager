<!DOCTYPE html><html><head><title>Mini LED Server</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" integrity="sha384-4LISF5TTJX/fLmGSxO53rV4miRxdg84mZsxmO8Rx5jGtp/LbrixFETvWa5a6sESd" crossorigin="anonymous"></head><body><div class="jumbotron"><div class="container"><h1>Mini LED Server</h1><p>Control your LEDstrip or array from here.</p></div></div><div class="container"><div class="row"><div class="col-md-4"><h2>Effect</h2><p>Run a predefined effect: <select id="cbxEffect"><option value="default" selected>Default</option><option value="beat" data-col="true">Beat</option><option value="rainbow">Rainbow</option><option value="showcase">Showcase</option><option value="solid" data-col="true">Solid Color</option><option value="image" data-img="true">Image</option><option value="northpole">North Pole (Red & White)</option><option value="quebec">Qu&eacute;bec (Blue & White)</option><option value="festive">Multicolor</option><option value="off">Off</option></select> <input id="colSolid" type="color"> <select id="cbxImageEffect"></select></p><p><a class="btn btn-primary" id="btnEffect" href="#" role="button">Set Effect</a> <input type="checkbox" id="chkDefaultEffect"> <label for="chkDefaultEffect">set as default effect</label></p><div id="txtSetEffectError" class="alert alert-warning">Error setting effect! - <span id="txtSetEffectErrorDescription"></span></div><div id="txtSetEffectSuccess" class="alert alert-success">Effect changed! - <span id="txtSetEffectSuccessDescription"></span></div><p></p></div><div class="col-md-4"><h2>Brightness</h2><p>Set brightness to : <span id="txtBrightness">64%</span></p><p><input type="range" min="0" max="100" value="64" class="slider" id="sldBrightness"></p><p><a class="btn btn-default" id="btnBrightness" href="#" role="button">Set Brightness</a></p></div><div class="col-md-4"><h2>Images <i class="bi bi-info-circle" title="<strong>Image specifications</strong>" data-toggle="popover" data-trigger="click" data-html="true" data-content="<i class='bi bi-crop'></i> Use 16x16 images, 16M colors.<br/><i class='bi bi-file-earmark'></i> Avoid .webp, they have issues."></i></h2><h3>Storage</h3><p>Used space:<progress id="proUsedSpace" value="50" max="100"></progress><span id="txtUsedSpace">1.0</span>/<span id="txtTotalSpace">1.0</span> MB (<span id="txtPctUsedSpace">100%</span>)</p><h3>Upload</h3><p>Upload a new image (<span id="w">0</span>x<span id="h">0</span>) <input type="file" id="btnBrowse"></p><p><canvas id="cvsImage" width="32" height="32"></p><p><input type="text" value="" id="txtImageName" minlength="3" maxlength="24" pattern="[a-zA-Z0-9_]+"> <input type="button" value="Upload" class="btn btn-success" id="btnUploadImage" role="button" disabled></p><p></p><div id="txtInvalidImageName" class="alert alert-warning">The image name is invalid. It must contain only letters and numbers, and have from 3 to 24 characters.</div><div id="txtUploadSuccess" class="alert alert-success"><strong>Success!</strong> File successfully uploaded.</div><p></p><h3>Delete</h3><p>Delete an existing image <select id="cbxImageDelete"></select> <input type="button" value="Delete" class="btn btn-danger" id="btnDeleteImage" role="button" disabled></p></div></div><hr><footer><p>Mini LED Server</p></footer></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><script lang="JavaScript">function readURL(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=function(){getImageInfo(this)},t.src=e.target.result,validateUploadForm()},t.readAsDataURL(e.files[0]),$("#txtImageName").val(e.files[0].name.replace(".","_"))}}function getImageInfo(e){var t=document.getElementById("cvsImage").getContext("2d");t.drawImage(e,0,0),$("#h").text(e.height),$("#w").text(e.width)}function getImageList(){var e="./api/images";$.ajax({url:e,success:function(e){var t=e.FilesList;if(t){$("#cbxImageDelete").html(""),$("#cbxImageEffect").html(""),$("#cbxImageDelete").append('<option value="" default></option>');for(var a=0;a<t.length;a++)$("#cbxImageDelete").append('<option value="'+t[a]+'">'+t[a]+"</option>"),$("#cbxImageEffect").append('<option value="'+t[a]+'">'+t[a]+"</option>")}}})}function uploadImage(){var e=document.getElementById("cvsImage").getContext("2d"),t=new Uint8Array(e.getImageData(0,0,16,16).data),a=$("#txtImageName").val(),o="";for(i=0;i<t.length;i+=4){var n=t[i+0],c=t[i+1],f=t[i+2];o+=toColor(n)+toColor(c)+toColor(f)}var r="./api/image?imgname="+a+"&imgdata="+o.toUpperCase();$.ajax({url:r,type:"PUT",processData:!1,success:function(){refreshForms(),$("#txtUploadSuccess").fadeIn("fast",function(){setTimeout(function(){$("#txtUploadSuccess").fadeOut("slow")},1500)}),updateStorageInfo()}})}function validateUploadForm(){var e=$("#txtImageName").attr("pattern"),t=new RegExp("^"+e+"$");t.test($("#txtImageName").val())&&2<$("#txtImageName").val().length?($("#txtInvalidImageName").hide(),""!=$("#btnBrowse").val()?$("#btnUploadImage").prop("disabled",!1):$("#btnUploadImage").prop("disabled",!0)):($("#btnUploadImage").prop("disabled",!0),0<$("#txtImageName").val().length?$("#txtInvalidImageName").show():$("#txtInvalidImageName").hide())}function refreshForms(){getImageList(),$("#txtImageName").val(""),$("#btnBrowse").val(""),updateEffectsControls(),$("#txtUploadSuccess").hide(),validateUploadForm();var e=document.getElementById("cvsImage"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height)}function isSelectedDataAttributeTrue(e,t){var a=$("#"+e).children("option:selected");return!0===a.data(t)}function effectHasColor(){return isSelectedDataAttributeTrue("cbxEffect","col")}function effectHasImage(){return isSelectedDataAttributeTrue("cbxEffect","img")}function updateEffectsControls(){$("#colSolid").hide(),$("#cbxImageEffect").hide(),$("#txtSetEffectError").hide(),$("#txtSetEffectSuccess").hide(),effectHasImage()?$("#cbxImageEffect").show():effectHasColor()&&$("#colSolid").show()}function updateStorageInfo(){$.ajax({url:"./api/storage",success:function(e){var t=e.UsedBytes/1024/1024,a=e.TotalBytes/1024/1024,o=Math.round(t/a*100);o<1?o=1:100<o&&(o=100),$("#proUsedSpace").val(o),$("#txtTotalSpace").text(a.toFixed(2)),$("#txtUsedSpace").text(t.toFixed(2)),$("#txtPctUsedSpace").text(o+"%")}})}function updateCurrentEffect(){$.ajax({url:"./api/effect",success:function(e){var t=e.UsedBytes/1024/1024,a=e.TotalBytes/1024/1024,o=Math.round(t/a*100);o<1?o=1:100<o&&(o=100),$("#cbxEffect").val(e.effect.toLowerCase()),$("#sldBrightness").val(e.brightness)}})}function toColor(e){return e<16?"0"+e.toString(16):e.toString(16)}$(function(){$("#btnEffect").on("click",function(){var e="./api/effect",t={};t=effectHasImage()?{name:$("#cbxEffect").val(),imgname:$("#cbxImageEffect").val()}:effectHasColor()?{name:$("#cbxEffect").val(),color:$("#colSolid").val().replace("#","")}:{name:$("#cbxEffect").val()},"on"===$("#chkDefaultEffect").val()?t.setdefault=1:t.setdefault=0,$.ajax({url:e,type:"PUT",data:t,success:function(e){$("#txtSetEffectSuccess").fadeIn("fast",function(){$("#txtSetEffectSuccessDescription").html(e),setTimeout(function(){$("#txtSetEffectSuccess").fadeOut("slow")},1500)})},error:function(e,t){$("#txtSetEffectError").fadeIn("fast",function(){$("#txtSetEffectErrorDescription").html(t),setTimeout(function(){$("#txtSetEffectError").fadeOut("slow")},1500)})}})}),$("#cbxEffect").change(function(){updateEffectsControls()}),$("#btnBrightness").on("click",function(){var e=parseInt($("#sldBrightness").val()),t="./api/effect",a={brightness:e.toString(16)};$.ajax({url:t,data:a})}),$("#sldBrightness").on("input",function(){var e=parseInt($("#sldBrightness").val());$("#txtBrightness").text(e.toString()+"%")}),$("#btnBrowse").change(function(){readURL(this)}),$("#txtImageName").on("keyup",function(){validateUploadForm()}),$("#btnUploadImage").on("click",function(){uploadImage()}),$("#cbxImageDelete").change(function(){""==$("#cbxImageDelete").val()?$("#btnDeleteImage").prop("disabled",!0):$("#btnDeleteImage").prop("disabled",!1)}),$("#btnDeleteImage").on("click",function(){var e=$("#cbxImageDelete").val(),t="./api/image?imgname="+e;$.ajax({url:t,type:"DELETE",processData:!1,success:function(){refreshForms(),updateStorageInfo()}})}),$('[data-toggle="popover"]').popover(),refreshForms(),updateStorageInfo(),updateCurrentEffect()})</script></body></html>