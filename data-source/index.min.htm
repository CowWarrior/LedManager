<!DOCTYPE html><html><head><title>Mini LED Server</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" integrity="sha384-4LISF5TTJX/fLmGSxO53rV4miRxdg84mZsxmO8Rx5jGtp/LbrixFETvWa5a6sESd" crossorigin="anonymous"></head><body><div class="jumbotron"><div class="container"><h1>Mini LED Server</h1><h2><span id="txtHostname"></span></h2><p>Control your LEDstrip or array from here.</p></div></div><div class="container"><div class="row"><div class="col-md-4"><h2>Effect</h2><p>Run a predefined effect: <select id="cbxEffect"><option value="default" selected>Default</option><option value="beat" data-col="true">Beat</option><option value="rainbow">Rainbow</option><option value="showcase">Showcase</option><option value="solid" data-col="true">Solid Color</option><option value="image" data-img="true">Image</option><option value="northpole">North Pole (Red & White)</option><option value="quebec">Qu&eacute;bec (Blue & White)</option><option value="festive">Multicolor</option><option value="off">Off</option></select> <input id="colSolid" type="color"> <select id="cbxImageEffect"></select></p><p><a class="btn btn-primary" id="btnEffect" href="#" role="button">Set Effect</a> <input type="checkbox" id="chkDefaultEffect"> <label for="chkDefaultEffect">set as default effect</label></p><div id="txtSetEffectError" class="alert alert-warning">Error setting effect! - <span id="txtSetEffectErrorDescription"></span></div><div id="txtSetEffectSuccess" class="alert alert-success">Effect changed! - <span id="txtSetEffectSuccessDescription"></span></div><p></p></div><div class="col-md-4"><h2>Brightness</h2><p>Set brightness to : <span id="txtBrightness">64%</span></p><p><input type="range" min="0" max="100" value="64" class="slider" id="sldBrightness"></p><p><a class="btn btn-default" id="btnBrightness" href="#" role="button">Set Brightness</a></p></div><div class="col-md-4"><h2>Images <i class="bi bi-info-circle" title="<strong>Image specifications</strong>" data-toggle="popover" data-trigger="click" data-html="true" data-content="<i class='bi bi-crop'></i> Use 16x16 images, 16M colors.<br/><i class='bi bi-file-earmark'></i> Avoid .webp, they have issues."></i></h2><h3>Storage</h3><p>Used space:<progress id="proUsedSpace" value="50" max="100"></progress><span id="txtUsedSpace">1.0</span>/<span id="txtTotalSpace">1.0</span> MB (<span id="txtPctUsedSpace">100%</span>)</p><h3>Upload</h3><p>Upload a new image (<span id="w">0</span>x<span id="h">0</span>) <input type="file" id="btnBrowse"></p><p><canvas id="cvsImage" width="32" height="32"></p><p><input type="text" value="" id="txtImageName" minlength="3" maxlength="24" pattern="[a-zA-Z0-9_]+"> <input type="button" value="Upload" class="btn btn-success" id="btnUploadImage" role="button" disabled></p><p></p><div id="txtInvalidImageName" class="alert alert-warning">The image name is invalid. It must contain only letters and numbers, and have from 3 to 24 characters.</div><div id="txtUploadSuccess" class="alert alert-success"><strong>Success!</strong> File successfully uploaded.</div><p></p><h3>Delete</h3><p>Delete an existing image <select id="cbxImageDelete"></select> <input type="button" value="Delete" class="btn btn-danger" id="btnDeleteImage" role="button" disabled></p></div></div><hr><footer><p>Mini LED Server (<span id="txtVersion"></span>) - <span id="txtSSID"></span><span id="txtdBm"></span></p></footer></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><script lang="JavaScript">function readURL(t){if(t.files&&t.files[0]){var e=new FileReader;e.onload=function(t){var e=new Image;e.onload=function(){getImageInfo(this)},e.src=t.target.result,validateUploadForm()},e.readAsDataURL(t.files[0]),$("#txtImageName").val(t.files[0].name.replace(".","_"))}}function getImageInfo(t){var e=document.getElementById("cvsImage").getContext("2d");e.drawImage(t,0,0),$("#h").text(t.height),$("#w").text(t.width)}function getImageList(){var t="./api/images";$.ajax({url:t,success:function(t){var e=t.FilesList;if(e){$("#cbxImageDelete").html(""),$("#cbxImageEffect").html(""),$("#cbxImageDelete").append('<option value="" default></option>');for(var a=0;a<e.length;a++)$("#cbxImageDelete").append('<option value="'+e[a]+'">'+e[a]+"</option>"),$("#cbxImageEffect").append('<option value="'+e[a]+'">'+e[a]+"</option>")}}})}function uploadImage(){var t=document.getElementById("cvsImage").getContext("2d"),e=new Uint8Array(t.getImageData(0,0,16,16).data),a=$("#txtImageName").val(),o="";for(i=0;i<e.length;i+=4){var n=e[i+0],c=e[i+1],s=e[i+2];o+=toColor(n)+toColor(c)+toColor(s)}var f="./api/image?imgname="+a+"&imgdata="+o.toUpperCase();$.ajax({url:f,type:"PUT",processData:!1,success:function(){refreshForms(),$("#txtUploadSuccess").fadeIn("fast",function(){setTimeout(function(){$("#txtUploadSuccess").fadeOut("slow")},1500)}),updateStorageInfo()}})}function validateUploadForm(){var t=$("#txtImageName").attr("pattern"),e=new RegExp("^"+t+"$");e.test($("#txtImageName").val())&&2<$("#txtImageName").val().length?($("#txtInvalidImageName").hide(),""!=$("#btnBrowse").val()?$("#btnUploadImage").prop("disabled",!1):$("#btnUploadImage").prop("disabled",!0)):($("#btnUploadImage").prop("disabled",!0),0<$("#txtImageName").val().length?$("#txtInvalidImageName").show():$("#txtInvalidImageName").hide())}function refreshForms(){getImageList(),$("#txtImageName").val(""),$("#btnBrowse").val(""),updateEffectsControls(),$("#txtUploadSuccess").hide(),validateUploadForm();var t=document.getElementById("cvsImage"),e=t.getContext("2d");e.clearRect(0,0,t.width,t.height)}function isSelectedDataAttributeTrue(t,e){var a=$("#"+t).children("option:selected");return!0===a.data(e)}function effectHasColor(){return isSelectedDataAttributeTrue("cbxEffect","col")}function effectHasImage(){return isSelectedDataAttributeTrue("cbxEffect","img")}function updateEffectsControls(){$("#colSolid").hide(),$("#cbxImageEffect").hide(),$("#txtSetEffectError").hide(),$("#txtSetEffectSuccess").hide(),effectHasImage()?$("#cbxImageEffect").show():effectHasColor()&&$("#colSolid").show()}function updateStorageInfo(){$.ajax({url:"./api/storage",success:function(t){var e=t.UsedBytes/1024/1024,a=t.TotalBytes/1024/1024,o=Math.round(e/a*100);o<1?o=1:100<o&&(o=100),$("#proUsedSpace").val(o),$("#txtTotalSpace").text(a.toFixed(2)),$("#txtUsedSpace").text(e.toFixed(2)),$("#txtPctUsedSpace").text(o+"%")}})}function updateDeviceInfo(){$.ajax({url:"./api/info",success:function(t){var e=t.device.hostname,a=t.device.ip,o=t.device.firmware,n=t.device.signal,i=t.device.ssid;updateSignalStrength(n),$("#txtHostname").text(e.toUpperCase()),$("#txtIP").text(a),$("#txtVersion").text(o),$("#txtSSID").text(i)}})}function updateSignalStrength(t){-30<t?$("#txtdBm").html("<i class='bi bi-wifi' alt='Excellent'></i>"):-67<t?$("#txtdBm").html("<i class='bi bi-wifi' alt='Good'></i>"):-70<t?$("#txtdBm").html("<i class='bi bi-wifi-2'  alt='OK'></i>"):-80<t?$("#txtdBm").html("<i class='bi bi-wifi-1'  alt='Passable'></i>"):$("#txtdBm").html("<i class='bi bi-wifi-off'  alt='Poor'></i>")}function updateCurrentEffect(){$.ajax({url:"./api/effect",success:function(t){var e=t.UsedBytes/1024/1024,a=t.TotalBytes/1024/1024,o=Math.round(e/a*100);o<1?o=1:100<o&&(o=100),$("#cbxEffect").val(t.effect.toLowerCase()),$("#sldBrightness").val(t.brightness)}})}function toColor(t){return t<16?"0"+t.toString(16):t.toString(16)}$(function(){$("#btnEffect").on("click",function(){var t="./api/effect",e={};e=effectHasImage()?{name:$("#cbxEffect").val(),imgname:$("#cbxImageEffect").val()}:effectHasColor()?{name:$("#cbxEffect").val(),color:$("#colSolid").val().replace("#","")}:{name:$("#cbxEffect").val()},"on"===$("#chkDefaultEffect").val()?e.setdefault=1:e.setdefault=0,$.ajax({url:t,type:"PUT",data:e,success:function(t){$("#txtSetEffectSuccess").fadeIn("fast",function(){$("#txtSetEffectSuccessDescription").html(t),setTimeout(function(){$("#txtSetEffectSuccess").fadeOut("slow")},1500)})},error:function(t,e){$("#txtSetEffectError").fadeIn("fast",function(){$("#txtSetEffectErrorDescription").html(e),setTimeout(function(){$("#txtSetEffectError").fadeOut("slow")},1500)})}})}),$("#cbxEffect").change(function(){updateEffectsControls()}),$("#btnBrightness").on("click",function(){var t=parseInt($("#sldBrightness").val()),e="./api/effect",a={brightness:t.toString(16)};$.ajax({url:e,data:a})}),$("#sldBrightness").on("input",function(){var t=parseInt($("#sldBrightness").val());$("#txtBrightness").text(t.toString()+"%")}),$("#btnBrowse").change(function(){readURL(this)}),$("#txtImageName").on("keyup",function(){validateUploadForm()}),$("#btnUploadImage").on("click",function(){uploadImage()}),$("#cbxImageDelete").change(function(){""==$("#cbxImageDelete").val()?$("#btnDeleteImage").prop("disabled",!0):$("#btnDeleteImage").prop("disabled",!1)}),$("#btnDeleteImage").on("click",function(){var t=$("#cbxImageDelete").val(),e="./api/image?imgname="+t;$.ajax({url:e,type:"DELETE",processData:!1,success:function(){refreshForms(),updateStorageInfo()}})}),$('[data-toggle="popover"]').popover(),updateDeviceInfo(),refreshForms(),updateStorageInfo(),updateCurrentEffect()})</script></body></html>